name: Update Upstream From Fork

on:
  push:
    branches:
      - master
      - v1.18
      - v1.17

env:
  GH_TOKEN: ${{ secrets.SYNC_TEST }}
  GH_TOKEN2: ${{ secrets.SYNC_TEST2 }}
  FOO: ${{ secrets.SYNC_TEST }}
  GH_REPO: ${{ github.repository }}

jobs:
  update-upstream-from-fork:
    name: "Update Upstream From Fork"
    runs-on: ubuntu-latest
    steps:
      - name: Echo ENV
        run: |
          echo $GH_TOKEN
          echo $GH_REPO
          echo $GH_TOKEN2
          echo $FOO
          gh auth status
          echo "git config: "
          git config -l
          echo "Grepped and cut:"
          git config -l | grep 'http\..*\.extraheader' | cut -d= -f1 |
        shell: bash
      - uses: actions/checkout@v4
      - name: Add remote for upstream
        run: git remote add upstream https://github.com/solana-labs/sync_test.git
        shell: bash
      - name: show remotes and branches
        run: |
          git remote --verbose
          git branch --all
        shell: bash
      - name: Cherry pick from origin/master to upstream/master
        run: |
          git config --global user.email "will.hickey@anza.xyz"
          git config --global user.name "GHA: Update Upstream From Fork"
          git fetch --all
          git checkout -b temp_branch remotes/upstream/master
          git cherry-pick remotes/upstream/master..origin/master
          git push upstream master
        shell: bash
# TODO the push will fail because or branch protection rules.            
